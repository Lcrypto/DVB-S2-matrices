%DVB_S2_to_parity.m
% Author: Cedric MARCHAND from Lab-STICC
% convert from DVB standard to Quasi Cyclic prototype matrix
% M is a size of information part
% A	is a matrix ct1 from getchecknodetable.m
% B is a matrix ct2 from getchecknodetable.m
% P is a circulant size





clear all;

% CR12
M12=9000;
A12=[20	712 2386	6354	4061	1062	5045	5158 
21	2543	5748	4822	2348	3089	6328	5876 
22	926	5701	269	3693	2438	3190	3507 
23	2802	4520	3577	5324	1091	4667	4449 
24	5140	2003	1263	4742	6497	1185	6202];
B12=[0	4046	6934 
1	2855	66 
2	6694	212 
3	3439	1158 
4	3850	4422 
5	5924	290 
6	1467	4049 
7	7820	2242 
8	4606	3080 
9	4633	7877 
10	3884	6868 
11	8935	4996 
12	3028	764 
13	5988	1057 
14	7411	3450]; 


%CR34 short frame
M34=4320;
A34=[3,3198,478,4207,1481,1009,2616,1924,3437,554,683,1801];
B34=[4,2681,2135
5,3107,4027
6,2637,3373
7,3830,3449
8,4129,2060
9,4184,2742
10,3946,1070
11,2239,984
0,1458,3031
1,3003,1328
2,1137,1716
3,132,3725
4,1817,638
5,1774,3447
6,3632,1257
7,542,3694
8,1015,1945
9,1948,412
10,995,2238
11,4141,1907
0,2480,3079
1,3021,1088
2,713,1379
3,997,3903
4,2323,3361
5,1110,986
6,2532,142
7,1690,2405
8,1298,1881
9,615,174
10,1648,3112
11,1415,2808];

%CR34 normal frame
M34L=16200;
A34L=[
0 6385 7901 14611 13389 11200 3252 5243 2504 2722 821 7374 
1 11359 2698 357 13824 12772 7244 6752 15310 852 2001 11417 
2 7862 7977 6321 13612 12197 14449 15137 13860 1708 6399 13444 
3 1560 11804 6975 13292 3646 3812 8772 7306 5795 14327 7866 
4 7626 11407 14599 9689 1628 2113 10809 9283 1230 15241 4870 
5 1610 5699 15876 9446 12515 1400 6303 5411 14181 13925 7358 
6 4059 8836 3405 7853 7992 15336 5970 10368 10278 9675 4651 
7 4441 3963 9153 2109 12683 7459 12030 12221 629 15212 406 
8 6007 8411 5771 3497 543 14202 875 9186 6235 13908 3563 
9 3232 6625 4795 546 9781 2071 7312 3399 7250 4932 12652 
10 8820 10088 11090 7069 6585 13134 10158 7183 488 7455 9238 
11 1903 10818 119 215 7558 11046 10615 11545 14784 7961 15619 
12 3655 8736 4917 15874 5129 2134 15944 14768 7150 2692 1469 
13 8316 3820 505 8923 6757 806 7957 4216 15589 13244 2622 
14 14463 4852 15733 3041 11193 12860 13673 8152 6551 15108 8758 
];
B34L=[15 3149 11981 
16 13416 6906 
17 13098 13352 
18 2009 14460 
19 7207 4314 
20 3312 3945 
21 4418 6248 
22 2669 13975 
23 7571 9023 
24 14172 2967 
25 7271 7138 
26 6135 13670 
27 7490 14559 
28 8657 2466 
29 8599 12834 
30 3470 3152 
31 13917 4365 
32 6024 13730 
33 10973 14182 
34 2464 13167 
35 5281 15049 
36 1103 1849 
37 2058 1069 
38 9654 6095 
39 14311 7667 
40 15617 8146 
41 4588 11218 
42 13660 6243 
43 8578 7874 
44 11741 2686 
0 1022 1264 
1 12604 9965 
2 8217 2707 
3 3156 11793 
4 354 1514 
5 6978 14058 
6 7922 16079 
7 15087 12138 
8 5053 6470 
9 12687 14932 
10 15458 1763 
11 8121 1721 
12 12431 549 
13 4129 7091 
14 1426 8415 
15 9783 7604 
16 6295 11329 
17 1409 12061 
18 8065 9087 
19 2918 8438 
20 1293 14115 
21 3922 13851 
22 3851 4000 
23 5865 1768 
24 2655 14957 
25 5565 6332 
26 4303 12631 
27 11653 12236 
28 16025 7632 
29 4655 14128 
30 9584 13123 
31 13987 9597 
32 15409 12110 
33 8754 15490 
34 7416 15325 
35 2909 15549 
36 2995 8257 
37 9406 4791 
38 11111 4854 
39 2812 8521 
40 8476 14717 
41 7820 15360 
42 1179 7939 
43 2357 8678 
44 7703 6216 
0 3477 7067 
1 3931 13845 
2 7675 12899 
3 1754 8187 
4 7785 1400 
5 9213 5891 
6 2494 7703 
7 2576 7902 
8 4821 15682 
9 10426 11935 
10 1810 904 
11 11332 9264 
12 11312 3570 
13 14916 2650 
14 7679 7842 
15 6089 13084 
16 3938 2751 
17 8509 4648 
18 12204 8917 
19 5749 12443 
20 12613 4431 
21 1344 4014 
22 8488 13850 
23 1730 14896 
24 14942 7126 
25 14983 8863 
26 6578 8564 
27 4947 396 
28 297 12805 
29 13878 6692 
30 11857 11186 
31 14395 11493 
32 16145 12251 
33 13462 7428 
34 14526 13119 
35 2535 11243 
36 6465 12690 
37 6872 9334 
38 15371 14023 
39 8101 10187 
40 11963 4848 
41 15125 6119 
42 8051 14465 
43 11139 5167 
44 2883 14521];


M12L=64800/2;
A12L = [54 9318 14392 27561 26909 10219 2534 8597
            55 7263 4635 2530 28130 3033 23830 3651
            56 24731 23583 26036 17299 5750 792 9169
            57 5811 26154 18653 11551 15447 13685 16264
            58 12610 11347 28768 2792 3174 29371 12997
            59 16789 16018 21449 6165 21202 15850 3186
            60 31016 21449 17618 6213 12166 8334 18212
            61 22836 14213 11327 5896 718 11727 9308
            62 2091 24941 29966 23634 9013 15587 5444
            63 22207 3983 16904 28534 21415 27524 25912
            64 25687 4501 22193 14665 14798 16158 5491
            65 4520 17094 23397 4264 22370 16941 21526
            66 10490 6182 32370 9597 30841 25954 2762
            67 22120 22865 29870 15147 13668 14955 19235
            68 6689 18408 18346 9918 25746 5443 20645
            69 29982 12529 13858 4746 30370 10023 24828
            70 1262 28032 29888 13063 24033 21951 7863
            71 6594 29642 31451 14831 9509 9335 31552
            72 1358 6454 16633 20354 24598 624 5265
            73 19529 295 18011 3080 13364 8032 15323
            74 11981 1510 7960 21462 9129 11370 25741
            75 9276 29656 4543 30699 20646 21921 28050
            76 15975 25634 5520 31119 13715 21949 19605
            77 18688 4608 31755 30165 13103 10706 29224
            78 21514 23117 12245 26035 31656 25631 30699
            79 9674 24966 31285 29908 17042 24588 31857
            80 21856 27777 29919 27000 14897 11409 7122
            81 29773 23310 263 4877 28622 20545 22092
            82 15605 5651 21864 3967 14419 22757 15896
            83 30145 1759 10139 29223 26086 10556 5098
            84 18815 16575 2936 24457 26738 6030 505
            85 30326 22298 27562 20131 26390 6247 24791
            86 928 29246 21246 12400 15311 32309 18608
            87 20314 6025 26689 16302 2296 3244 19613
            88 6237 11943 22851 15642 23857 15112 20947
            89 26403 25168 19038 18384 8882 12719 7093];
B12L=[0 14567 24965
            1 3908 100
            2 10279 240
            3 24102 764
            4 12383 4173
            5 13861 15918
            6 21327 1046
            7 5288 14579
            8 28158 8069
            9 16583 11098
            10 16681 28363
            11 13980 24725
            12 32169 17989
            13 10907 2767
            14 21557 3818
            15 26676 12422
            16 7676 8754
            17 14905 20232
            18 15719 24646
            19 31942 8589
            20 19978 27197
            21 27060 15071
            22 6071 26649
            23 10393 11176
            24 9597 13370
            25 7081 17677
            26 1433 19513
            27 26925 9014
            28 19202 8900
            29 18152 30647
            30 20803 1737
            31 11804 25221
            32 31683 17783
            33 29694 9345
            34 12280 26611
            35 6526 26122
            36 26165 11241
            37 7666 26962
            38 16290 8480
            39 11774 10120
            40 30051 30426
            41 1335 15424
            42 6865 17742
            43 31779 12489
            44 32120 21001
            45 14508 6996
            46 979 25024
            47 4554 21896
            48 7989 21777
            49 4972 20661
            50 6612 2730
            51 12742 4418
            52 29194 595
            53 19267 20113];



M=M12L;
A=A12L;
B=B12L;
P=360;


N=64800;
K=N-M;
rate=K/N;
q=M/P;

N_QC=N/P;
M_QC=M/P;
K_QC=K/P;
parity_QC = zeros(M_QC,N_QC);
parity_QC = parity_QC -1;


[ nb_blksA,dv_a  ]=size(A);
[ nb_blksB,dv_b  ]=size(B);



for x=1:nb_blksA
    for i=1:dv_a
        tmp = A(x,i);
        parity_QC(floor(tmp/P)+1 ,x)= mod(tmp,P);
    end
end

for x=1:nb_blksB
    for i=1:dv_b
        tmp = B(x,i);
        parity_QC(floor(tmp/P)+1,x + nb_blksA)= mod(tmp,P);
    end
end


% ira
parity_QC(1,K_QC+1) = 0;
for i=2:M_QC
   parity_QC(i,K_QC+i-1)=0;
   parity_QC(i,K_QC+i)=0;
end

parity_QC

%%THis function exist from R2021b or use save to text file and use qc2sparse function
H = ldpcQuasiCyclicMatrix(P,parity_QC);
